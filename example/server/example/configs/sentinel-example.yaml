# Sentinel-X Example Server Configuration
# This file can be placed in:
#   - ./sentinel-example.yaml
#   - ./configs/sentinel-example.yaml
#   - ~/.sentinel-example/sentinel-example.yaml
#   - /etc/sentinel-example/sentinel-example.yaml

# Server configuration
server:
  # Server mode: http, grpc, or both
  mode: both
  # Graceful shutdown timeout
  shutdown-timeout: 30s

# HTTP server configuration
http:
  # Listen address
  addr: ":8081"
  # Read timeout
  read-timeout: 30s
  # Write timeout
  write-timeout: 30s
  # Idle timeout
  idle-timeout: 60s
  # HTTP framework adapter: gin or echo
  adapter: gin

  # Middleware configuration
  middleware:
    # Recovery middleware
    disable-recovery: false
    recovery:
      enable-stack-trace: false

    # Request ID middleware
    disable-request-id: false
    request-id:
      header: "X-Request-ID"

    # Logger middleware
    disable-logger: false
    logger:
      skip-paths:
        - "/health"
        - "/ready"
        - "/live"
        - "/metrics"

    # CORS middleware (disabled by default)
    disable-cors: true
    cors:
      allow-origins:
        - "*"
      allow-methods:
        - "GET"
        - "POST"
        - "PUT"
        - "PATCH"
        - "DELETE"
        - "HEAD"
        - "OPTIONS"
      allow-headers:
        - "Origin"
        - "Content-Type"
        - "Accept"
        - "Authorization"
        - "X-Request-ID"
      allow-credentials: false
      max-age: 86400

    # Timeout middleware (disabled by default)
    disable-timeout: true
    timeout:
      timeout: 30s
      skip-paths:
        - "/health"
        - "/ready"
        - "/live"
        - "/metrics"

    # Health check endpoints
    disable-health: false
    health:
      path: "/health"
      liveness-path: "/live"
      readiness-path: "/ready"

    # Metrics endpoint
    disable-metrics: false
    metrics:
      path: "/metrics"
      namespace: "sentinel"
      subsystem: "example"

    # Pprof endpoints (disabled by default for security)
    disable-pprof: true
    pprof:
      prefix: "/debug/pprof"
      enable-cmdline: true
      enable-profile: true
      enable-symbol: true
      enable-trace: true
      block-profile-rate: 0
      mutex-profile-fraction: 0

# gRPC server configuration
grpc:
  # Listen address
  addr: ":9091"
  # Request timeout
  timeout: 30s
  # Max receive message size (16MB)
  max-recv-msg-size: 16777216
  # Max send message size (16MB)
  max-send-msg-size: 16777216
  # Enable reflection for grpcurl
  enable-reflection: true

# JWT authentication configuration
jwt:
  # Disable JWT authentication (set to false to enable)
  disable-auth: false
  # JWT signing key (min 32 characters for HMAC algorithms)
  # 必须通过环境变量设置: SENTINEL_EXAMPLE_JWT_KEY
  # 不要在配置文件中硬编码密钥！
  key: ""
  # JWT signing algorithm
  signing-method: "HS256"
  # Token expiration duration
  expired: "2h"
  # Maximum duration a token can be refreshed
  max-refresh: "24h"
  # Token issuer
  issuer: "sentinel-x-example"
  # Token audience
  audience:
    - "api"
